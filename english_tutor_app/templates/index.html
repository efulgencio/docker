<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutor de Inglés con IA</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; background-color: #f4f7f9; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: #fff; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        h1 { text-align: center; color: #0056b3; }
        .input-area { display: flex; gap: 10px; margin-bottom: 20px; }
        #query-input { flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; }
        button { padding: 10px 15px; border: none; border-radius: 5px; background-color: #007bff; color: white; cursor: pointer; font-size: 16px; }
        button:hover { background-color: #0056b3; }
        #quiz-btn { background-color: #28a745; }
        #quiz-btn:hover { background-color: #218838; }
        #quiz-btn:disabled { background-color: #ccc; cursor: not-allowed; }
        .response-area { margin-top: 20px; padding: 15px; background: #e9ecef; border-radius: 5px; min-height: 100px; }
        .loader { text-align: center; display: none; font-size: 18px; padding: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #ddd; }
        th { background-color: #007bff; color: white; }
        .quiz-question { margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #ccc; }
        .quiz-answer { color: #28a745; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Tutor de Inglés con IA</h1>
        <div class="input-area">
            <input type="text" id="query-input" placeholder="Pregunta sobre un tema (ej: 'pronombres')">
            <button id="ask-btn">Preguntar</button>
            <button id="quiz-btn" disabled>Generar Examen</button>
        </div>
        <div class="response-area">
            <div id="response-content">Escribe un tema para empezar...</div>
            <div class="loader" id="loader">Cargando...</div>
        </div>
    </div>

    <script>
        const askBtn = document.getElementById('ask-btn');
        const quizBtn = document.getElementById('quiz-btn');
        const queryInput = document.getElementById('query-input');
        const responseContent = document.getElementById('response-content');
        const loader = document.getElementById('loader');
        
        let lastTopic = '';

        askBtn.addEventListener('click', handleAsk);
        quizBtn.addEventListener('click', handleQuiz);
        queryInput.addEventListener('keyup', (event) => {
            if (event.key === 'Enter') {
                handleAsk();
            }
        });

        async function handleAsk() {
            const query = queryInput.value.trim();
            if (!query) return;

            lastTopic = query;
            showLoader(true);
            
            try {
                const response = await fetch('/ask', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: query })
                });
                const data = await response.json();
                renderResponse(data);
                quizBtn.disabled = false;
            } catch (error) {
                responseContent.innerHTML = `<p style="color: red;">Error: No se pudo contactar al servidor.</p>`;
            } finally {
                showLoader(false);
            }
        }

        async function handleQuiz() {
            if (!lastTopic) return;

            showLoader(true);
            
            try {
                const response = await fetch('/quiz', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ topic: lastTopic })
                });
                const data = await response.json();
                renderResponse(data);
            } catch (error) {
                responseContent.innerHTML = `<p style="color: red;">Error: No se pudo contactar al servidor.</p>`;
            } finally {
                showLoader(false);
            }
        }

        function renderResponse(data) {
            if (data.type === 'explanation') {
                let html = `<h3>${data.title}</h3><table><tr><th>English</th><th>Español</th></tr>`;
                data.content.forEach(item => {
                    html += `<tr><td>${item.en}</td><td>${item.es}</td></tr>`;
                });
                html += '</table>';
                responseContent.innerHTML = html;
            } else if (data.type === 'quiz') {
                let html = `<h3>${data.title}</h3>`;
                data.questions.forEach((q, index) => {
                    html += `<div class="quiz-question">
                                <p><b>${index + 1}. ${q.question}</b></p>`;
                    q.options.forEach(opt => {
                        html += `<label style="display: block; margin-left: 20px;"><input type="radio" name="q${index}" value="${opt}"> ${opt}</label>`;
                    });
                    html += `<p style="display: none;" class="quiz-answer">Respuesta: ${q.answer}</p>
                             </div>`;
                });
                html += `<button onclick="showAnswers()">Mostrar Respuestas</button>`;
                responseContent.innerHTML = html;
            } else {
                responseContent.innerHTML = `<p style="color: red;">Respuesta no reconocida.</p>`;
            }
        }
        
        function showAnswers() {
            document.querySelectorAll('.quiz-answer').forEach(el => {
                el.style.display = 'block';
            });
        }

        function showLoader(isLoading) {
            if (isLoading) {
                loader.style.display = 'block';
                responseContent.style.display = 'none';
            } else {
                loader.style.display = 'none';
                responseContent.style.display = 'block';
            }
        }
    </script>
</body>
</html>
